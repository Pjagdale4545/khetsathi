<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{farmer.register.title}">Farmer Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .card-custom { background-color: #ffffff; border-radius: 1rem; padding: 2rem; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-green { background-color: #28a745; border-color: #28a745; color: white; }
        .btn-green:hover { background-color: #218838; border-color: #218838; }
        .hidden { display: none; }

       .login-logo-container {
           text-align: center;
           margin-bottom: 0%;
       }

       .centered-login-logo {
           height: 80px;
           width: auto;
          }
       .container h2 {
           margin-top: 10px;
           margin-bottom: 25px;
       }

    </style>
</head>
<body>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card card-custom">
                <div class="card-body">
                    <div class="login-logo-container">
                        <img src="/images/background.jpg" alt="Khetsaathi Logo" class="centered-login-logo">
                    </div>

                    <h2 class="card-title text-center mb-4" th:text="#{farmer.register.title}">Farmer Registration</h2>

                    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
                    <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>

                    <form id="sendOtpForm" th:action="@{/farmer/send-otp}" method="post">
                        <div class="mb-3">
                            <label for="mobileNumberOtp" class="form-label" th:text="#{farmer.register.label.mobile}">Mobile Number</label>
                            <input type="text" id="mobileNumberOtp" name="mobileNumber" class="form-control"
                                   th:value="${registrationForm.mobileNumber}" required>
                        </div>
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit" class="btn btn-green w-100" th:text="#{farmer.register.button.send_otp}">Send OTP</button>
                    </form>

                    <hr class="my-4" id="separator" th:classappend="${registrationForm.mobileNumber != null ? '' : 'hidden'}">

                    <form id="registerForm" th:action="@{/farmer/register}" th:object="${registrationForm}" method="post"
                          th:classappend="${registrationForm.mobileNumber != null ? '' : 'hidden'}">

                        <div class="mb-3">
                            <label for="fullName" class="form-label" th:text="#{farmer.register.label.full_name}">Full Name</label>
                            <input type="text" id="fullName" th:field="*{fullName}" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label for="mobileNumberDisplay" class="form-label" th:text="#{farmer.register.label.registered_mobile}">Registered Mobile Number</label>
                            <input type="text" id="mobileNumberDisplay" th:field="*{mobileNumber}" class="form-control" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label" th:text="#{farmer.register.label.email}">Email (Optional)</label>
                            <input type="email" id="email" th:field="*{email}" class="form-control">
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label" th:text="#{farmer.register.label.password}">Set Password (Last 5 digits of Mobile Number)</label>
                            <input type="password" id="password" th:field="*{password}" class="form-control"
                                   th:value="${registrationForm.mobileNumber != null ? registrationForm.mobileNumber.substring(T(java.lang.Math).max(0, registrationForm.mobileNumber.length() - 5)) : ''}"
                                   readonly>
                        </div>

                        <div class="mb-3">
                            <label for="otp" class="form-label" th:text="#{farmer.register.label.otp}">Enter OTP</label>
                            <input type="text" id="otp" name="otp" class="form-control" required>
                        </div>
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit" class="btn btn-green w-100" th:text="#{farmer.register.button.register}">Register</button>
                    </form>
                    <hr class="my-4">
                    <p class="text-center"><span th:text="#{farmer.register.link.already_account}">Already have an account? </span><a th:href="@{/farmer/login}" th:text="#{farmer.register.link.login}">Login here</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const registrationForm = /*[[${registrationForm}]]*/ {};

    const sendOtpForm = document.getElementById('sendOtpForm');
    const registerForm = document.getElementById('registerForm');
    const separator = document.getElementById('separator');
    const mobileNumberOtpInput = document.getElementById('mobileNumberOtp');

    if (registrationForm && registrationForm.mobileNumber) {
        sendOtpForm.classList.add('hidden');
        separator.classList.remove('hidden');
        registerForm.classList.remove('hidden');
        mobileNumberOtpInput.value = registrationForm.mobileNumber;
        mobileNumberOtpInput.readOnly = true;
    } else {
        sendOtpForm.classList.remove('hidden');
        separator.classList.add('hidden');
        registerForm.classList.add('hidden');
    }
</script>
</body>
</html>
